---
source: parser/src/lexer/mod.rs
description: "def _handle_ticker_index(symbol):\n    ticker_index = symbols_data.get_ticker_index(symbol)\n\n    if ticker_index is None:\n        market_symbol = get_symbol_info(symbol)\n        if market_symbol is not None:\n            symbols_data.append_symbol_to_file(market_symbol)\n            ticker_index = market_symbol.index\n    return ticker_index\n\n\ndef _extract_ticker_client_types_data(ticker_index: str) -> List:\n    url = TSE_CLIENT_TYPE_DATA_URL.format(ticker_index)\n    with requests_retry_session() as session:\n        response = session.get(url, timeout=5)\n    data = response.text.split(';')\n    return data\n\ndef common_process(df: pd.DataFrame, date: str):\n    if len(df) == 0:\n        return pd.DataFrame(columns=list(api_to_orderbook_mapping.keys()))\n    df.rename(columns=reversed_keys, inplace=True)\n    df = df.loc[:, list(api_to_orderbook_mapping.keys())]\n    df[\"datetime\"] = pd.to_datetime(\n        date + \" \" + df[\"datetime\"].astype(str), format=\"%Y%m%d %H%M%S\"\n    )\n    df = df.sort_values([\"datetime\", \"depth\"], ascending=[True, True])\n    df.set_index(\"datetime\", inplace=True)\n    df.drop(columns=[\"refID\"], inplace=True)\n    return df\n\n"
input_file: parser/test_data/inputs/functions.py
---
0,3: Def   (None)
4,24: Identifier   (Str("_handle_ticker_index"))
24,25: (   (None)
25,31: Identifier   (Str("symbol"))
31,32: )   (None)
32,33: :   (None)
33,34: NewLine   (None)
34,38: Indent   (Indent(1))
38,50: Identifier   (Str("ticker_index"))
51,52: =   (None)
53,65: Identifier   (Str("symbols_data"))
65,66: .   (None)
66,82: Identifier   (Str("get_ticker_index"))
82,83: (   (None)
83,89: Identifier   (Str("symbol"))
89,90: )   (None)
90,91: NewLine   (None)
91,92: NewLine   (None)
96,98: If   (None)
99,111: Identifier   (Str("ticker_index"))
112,114: Is   (None)
115,119: None   (None)
119,120: :   (None)
120,121: NewLine   (None)
121,129: Indent   (Indent(1))
129,142: Identifier   (Str("market_symbol"))
143,144: =   (None)
145,160: Identifier   (Str("get_symbol_info"))
160,161: (   (None)
161,167: Identifier   (Str("symbol"))
167,168: )   (None)
168,169: NewLine   (None)
177,179: If   (None)
180,193: Identifier   (Str("market_symbol"))
194,196: Is   (None)
197,200: Not   (None)
201,205: None   (None)
205,206: :   (None)
206,207: NewLine   (None)
207,219: Indent   (Indent(1))
219,231: Identifier   (Str("symbols_data"))
231,232: .   (None)
232,253: Identifier   (Str("append_symbol_to_file"))
253,254: (   (None)
254,267: Identifier   (Str("market_symbol"))
267,268: )   (None)
268,269: NewLine   (None)
281,293: Identifier   (Str("ticker_index"))
294,295: =   (None)
296,309: Identifier   (Str("market_symbol"))
309,310: .   (None)
310,315: Identifier   (Str("index"))
315,316: NewLine   (None)
316,320: Dedent   (Indent(2))
320,320: Dedent   (None)
320,326: Return   (None)
327,339: Identifier   (Str("ticker_index"))
339,340: NewLine   (None)
340,341: NewLine   (None)
341,342: NewLine   (None)
342,342: Dedent   (Indent(1))
342,345: Def   (None)
346,379: Identifier   (Str("_extract_ticker_client_types_data"))
379,380: (   (None)
380,392: Identifier   (Str("ticker_index"))
392,393: :   (None)
394,397: Identifier   (Str("str"))
397,398: )   (None)
399,401: ->   (None)
402,406: Identifier   (Str("List"))
406,407: :   (None)
407,408: NewLine   (None)
408,412: Indent   (Indent(1))
412,415: Identifier   (Str("url"))
416,417: =   (None)
418,442: Identifier   (Str("TSE_CLIENT_TYPE_DATA_URL"))
442,443: .   (None)
443,449: Identifier   (Str("format"))
449,450: (   (None)
450,462: Identifier   (Str("ticker_index"))
462,463: )   (None)
463,464: NewLine   (None)
468,472: With   (None)
473,495: Identifier   (Str("requests_retry_session"))
495,496: (   (None)
496,497: )   (None)
498,500: As   (None)
501,508: Identifier   (Str("session"))
508,509: :   (None)
509,510: NewLine   (None)
510,518: Indent   (Indent(1))
518,526: Identifier   (Str("response"))
527,528: =   (None)
529,536: Identifier   (Str("session"))
536,537: .   (None)
537,540: Identifier   (Str("get"))
540,541: (   (None)
541,544: Identifier   (Str("url"))
544,545: ,   (None)
546,553: Identifier   (Str("timeout"))
553,554: =   (None)
554,555: Integer   (Number("5"))
555,556: )   (None)
556,557: NewLine   (None)
557,561: Dedent   (Indent(1))
561,565: Identifier   (Str("data"))
566,567: =   (None)
568,576: Identifier   (Str("response"))
576,577: .   (None)
577,581: Identifier   (Str("text"))
581,582: .   (None)
582,587: Identifier   (Str("split"))
587,588: (   (None)
588,591: StringLiteral   (Str("';'"))
591,592: )   (None)
592,593: NewLine   (None)
597,603: Return   (None)
604,608: Identifier   (Str("data"))
608,609: NewLine   (None)
609,610: NewLine   (None)
610,610: Dedent   (Indent(1))
610,613: Def   (None)
614,628: Identifier   (Str("common_process"))
628,629: (   (None)
629,631: Identifier   (Str("df"))
631,632: :   (None)
633,635: Identifier   (Str("pd"))
635,636: .   (None)
636,645: Identifier   (Str("DataFrame"))
645,646: ,   (None)
647,651: Identifier   (Str("date"))
651,652: :   (None)
653,656: Identifier   (Str("str"))
656,657: )   (None)
657,658: :   (None)
658,659: NewLine   (None)
659,663: Indent   (Indent(1))
663,665: If   (None)
666,669: Identifier   (Str("len"))
669,670: (   (None)
670,672: Identifier   (Str("df"))
672,673: )   (None)
674,676: ==   (None)
677,678: Integer   (Number("0"))
678,679: :   (None)
679,680: NewLine   (None)
680,688: Indent   (Indent(1))
688,694: Return   (None)
695,697: Identifier   (Str("pd"))
697,698: .   (None)
698,707: Identifier   (Str("DataFrame"))
707,708: (   (None)
708,715: Identifier   (Str("columns"))
715,716: =   (None)
716,720: Identifier   (Str("list"))
720,721: (   (None)
721,745: Identifier   (Str("api_to_orderbook_mapping"))
745,746: .   (None)
746,750: Identifier   (Str("keys"))
750,751: (   (None)
751,752: )   (None)
752,753: )   (None)
753,754: )   (None)
754,755: NewLine   (None)
755,759: Dedent   (Indent(1))
759,761: Identifier   (Str("df"))
761,762: .   (None)
762,768: Identifier   (Str("rename"))
768,769: (   (None)
769,776: Identifier   (Str("columns"))
776,777: =   (None)
777,790: Identifier   (Str("reversed_keys"))
790,791: ,   (None)
792,799: Identifier   (Str("inplace"))
799,800: =   (None)
800,804: True   (None)
804,805: )   (None)
805,806: NewLine   (None)
810,812: Identifier   (Str("df"))
813,814: =   (None)
815,817: Identifier   (Str("df"))
817,818: .   (None)
818,821: Identifier   (Str("loc"))
821,822: [   (None)
822,823: :   (None)
823,824: ,   (None)
825,829: Identifier   (Str("list"))
829,830: (   (None)
830,854: Identifier   (Str("api_to_orderbook_mapping"))
854,855: .   (None)
855,859: Identifier   (Str("keys"))
859,860: (   (None)
860,861: )   (None)
861,862: )   (None)
862,863: ]   (None)
863,864: NewLine   (None)
868,870: Identifier   (Str("df"))
870,871: [   (None)
871,881: StringLiteral   (Str("\"datetime\""))
881,882: ]   (None)
883,884: =   (None)
885,887: Identifier   (Str("pd"))
887,888: .   (None)
888,899: Identifier   (Str("to_datetime"))
899,900: (   (None)
900,901: NewLine   (None)
909,913: Identifier   (Str("date"))
914,915: +   (None)
916,919: StringLiteral   (Str("\" \""))
920,921: +   (None)
922,924: Identifier   (Str("df"))
924,925: [   (None)
925,935: StringLiteral   (Str("\"datetime\""))
935,936: ]   (None)
936,937: .   (None)
937,943: Identifier   (Str("astype"))
943,944: (   (None)
944,947: Identifier   (Str("str"))
947,948: )   (None)
948,949: ,   (None)
950,956: Identifier   (Str("format"))
956,957: =   (None)
957,972: StringLiteral   (Str("\"%Y%m%d %H%M%S\""))
972,973: NewLine   (None)
977,978: )   (None)
978,979: NewLine   (None)
983,985: Identifier   (Str("df"))
986,987: =   (None)
988,990: Identifier   (Str("df"))
990,991: .   (None)
991,1002: Identifier   (Str("sort_values"))
1002,1003: (   (None)
1003,1004: [   (None)
1004,1014: StringLiteral   (Str("\"datetime\""))
1014,1015: ,   (None)
1016,1023: StringLiteral   (Str("\"depth\""))
1023,1024: ]   (None)
1024,1025: ,   (None)
1026,1035: Identifier   (Str("ascending"))
1035,1036: =   (None)
1036,1037: [   (None)
1037,1041: True   (None)
1041,1042: ,   (None)
1043,1047: True   (None)
1047,1048: ]   (None)
1048,1049: )   (None)
1049,1050: NewLine   (None)
1054,1056: Identifier   (Str("df"))
1056,1057: .   (None)
1057,1066: Identifier   (Str("set_index"))
1066,1067: (   (None)
1067,1077: StringLiteral   (Str("\"datetime\""))
1077,1078: ,   (None)
1079,1086: Identifier   (Str("inplace"))
1086,1087: =   (None)
1087,1091: True   (None)
1091,1092: )   (None)
1092,1093: NewLine   (None)
1097,1099: Identifier   (Str("df"))
1099,1100: .   (None)
1100,1104: Identifier   (Str("drop"))
1104,1105: (   (None)
1105,1112: Identifier   (Str("columns"))
1112,1113: =   (None)
1113,1114: [   (None)
1114,1121: StringLiteral   (Str("\"refID\""))
1121,1122: ]   (None)
1122,1123: ,   (None)
1124,1131: Identifier   (Str("inplace"))
1131,1132: =   (None)
1132,1136: True   (None)
1136,1137: )   (None)
1137,1138: NewLine   (None)
1142,1148: Return   (None)
1149,1151: Identifier   (Str("df"))
1151,1152: NewLine   (None)
1152,1152: Dedent   (Indent(1))
1152,1153: NewLine   (None)
