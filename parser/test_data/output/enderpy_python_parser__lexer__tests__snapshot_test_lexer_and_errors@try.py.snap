---
source: parser/src/lexer/mod.rs
description: "# in some cases last price or adj price is undefined\ntry:\n    last_price = int(price_section[2])\n# when instead of number value is `F`\nexcept (ValueError, IndexError):\n    last_price = None\ntry:\n    adj_close = int(price_section[3])\nexcept (ValueError, IndexError):\n    adj_close = None\ntry:\n    market_cap = adj_close * self.total_shares\nexcept ValueError:\n    market_cap = None\n\n\ntry:\n    async with session.get(url, headers=TRADE_DETAILS_HEADER, timeout=100) as response:\n        if response.status == 503:\n            logger.info(f\"Received 503 Service Unavailable on {date_obj}. Retrying...\")\n            retry_count += 1\n            await asyncio.sleep(1)\n        else:\n            response.raise_for_status()\n            data = await response.json()\n            logger.info(f\"Successfully fetched trade details on {date_obj} from tse\")\n            return [date_obj, pd.json_normalize(data[\"tradeHistory\"])]\nexcept (aiohttp.ClientError, asyncio.TimeoutError):\n    logger.error(f\"Request failed for {date_obj}. Retrying...\")\n    retry_count += 1\n    await asyncio.sleep(1)\n"
input_file: parser/test_data/inputs/try.py
---
0,52: Comment   (Str("# in some cases last price or adj price is undefined"))
52,53: NL   (None)
53,56: Try   (None)
56,57: :   (None)
57,58: NewLine   (None)
58,62: Indent   (Indent(1))
62,72: Identifier   (Str("last_price"))
73,74: =   (None)
75,78: Identifier   (Str("int"))
78,79: (   (None)
79,92: Identifier   (Str("price_section"))
92,93: [   (None)
93,94: Integer   (Number("2"))
94,95: ]   (None)
95,96: )   (None)
96,97: NewLine   (None)
97,97: Dedent   (Indent(1))
97,134: Comment   (Str("# when instead of number value is `F`"))
134,135: NewLine   (None)
135,141: Except   (None)
142,143: (   (None)
143,153: Identifier   (Str("ValueError"))
153,154: ,   (None)
155,165: Identifier   (Str("IndexError"))
165,166: )   (None)
166,167: :   (None)
167,168: NewLine   (None)
168,172: Indent   (Indent(1))
172,182: Identifier   (Str("last_price"))
183,184: =   (None)
185,189: None   (None)
189,190: NewLine   (None)
190,190: Dedent   (Indent(1))
190,193: Try   (None)
193,194: :   (None)
194,195: NewLine   (None)
195,199: Indent   (Indent(1))
199,208: Identifier   (Str("adj_close"))
209,210: =   (None)
211,214: Identifier   (Str("int"))
214,215: (   (None)
215,228: Identifier   (Str("price_section"))
228,229: [   (None)
229,230: Integer   (Number("3"))
230,231: ]   (None)
231,232: )   (None)
232,233: NewLine   (None)
233,233: Dedent   (Indent(1))
233,239: Except   (None)
240,241: (   (None)
241,251: Identifier   (Str("ValueError"))
251,252: ,   (None)
253,263: Identifier   (Str("IndexError"))
263,264: )   (None)
264,265: :   (None)
265,266: NewLine   (None)
266,270: Indent   (Indent(1))
270,279: Identifier   (Str("adj_close"))
280,281: =   (None)
282,286: None   (None)
286,287: NewLine   (None)
287,287: Dedent   (Indent(1))
287,290: Try   (None)
290,291: :   (None)
291,292: NewLine   (None)
292,296: Indent   (Indent(1))
296,306: Identifier   (Str("market_cap"))
307,308: =   (None)
309,318: Identifier   (Str("adj_close"))
319,320: *   (None)
321,325: Identifier   (Str("self"))
325,326: .   (None)
326,338: Identifier   (Str("total_shares"))
338,339: NewLine   (None)
339,339: Dedent   (Indent(1))
339,345: Except   (None)
346,356: Identifier   (Str("ValueError"))
356,357: :   (None)
357,358: NewLine   (None)
358,362: Indent   (Indent(1))
362,372: Identifier   (Str("market_cap"))
373,374: =   (None)
375,379: None   (None)
379,380: NewLine   (None)
380,381: NL   (None)
381,382: NL   (None)
382,382: Dedent   (Indent(1))
382,385: Try   (None)
385,386: :   (None)
386,387: NewLine   (None)
387,391: Indent   (Indent(1))
391,396: Async   (None)
397,401: With   (None)
402,409: Identifier   (Str("session"))
409,410: .   (None)
410,413: Identifier   (Str("get"))
413,414: (   (None)
414,417: Identifier   (Str("url"))
417,418: ,   (None)
419,426: Identifier   (Str("headers"))
426,427: =   (None)
427,447: Identifier   (Str("TRADE_DETAILS_HEADER"))
447,448: ,   (None)
449,456: Identifier   (Str("timeout"))
456,457: =   (None)
457,460: Integer   (Number("100"))
460,461: )   (None)
462,464: As   (None)
465,473: Identifier   (Str("response"))
473,474: :   (None)
474,475: NewLine   (None)
475,483: Indent   (Indent(1))
483,485: If   (None)
486,494: Identifier   (Str("response"))
494,495: .   (None)
495,501: Identifier   (Str("status"))
502,504: ==   (None)
505,508: Integer   (Number("503"))
508,509: :   (None)
509,510: NewLine   (None)
510,522: Indent   (Indent(1))
522,528: Identifier   (Str("logger"))
528,529: .   (None)
529,533: Identifier   (Str("info"))
533,534: (   (None)
534,536: FStringStart   (Str("f\""))
536,572: FstringMiddle   (Str("Received 503 Service Unavailable on "))
572,573: {   (None)
573,581: Identifier   (Str("date_obj"))
581,582: }   (None)
582,595: FstringMiddle   (Str(". Retrying..."))
595,596: FStringEnd   (Str("\""))
596,597: )   (None)
597,598: NewLine   (None)
610,621: Identifier   (Str("retry_count"))
622,624: +=   (None)
625,626: Integer   (Number("1"))
626,627: NewLine   (None)
639,644: Await   (None)
645,652: Identifier   (Str("asyncio"))
652,653: .   (None)
653,658: Identifier   (Str("sleep"))
658,659: (   (None)
659,660: Integer   (Number("1"))
660,661: )   (None)
661,662: NewLine   (None)
662,670: Dedent   (Indent(1))
670,674: Else   (None)
674,675: :   (None)
675,676: NewLine   (None)
676,688: Indent   (Indent(1))
688,696: Identifier   (Str("response"))
696,697: .   (None)
697,713: Identifier   (Str("raise_for_status"))
713,714: (   (None)
714,715: )   (None)
715,716: NewLine   (None)
728,732: Identifier   (Str("data"))
733,734: =   (None)
735,740: Await   (None)
741,749: Identifier   (Str("response"))
749,750: .   (None)
750,754: Identifier   (Str("json"))
754,755: (   (None)
755,756: )   (None)
756,757: NewLine   (None)
769,775: Identifier   (Str("logger"))
775,776: .   (None)
776,780: Identifier   (Str("info"))
780,781: (   (None)
781,783: FStringStart   (Str("f\""))
783,821: FstringMiddle   (Str("Successfully fetched trade details on "))
821,822: {   (None)
822,830: Identifier   (Str("date_obj"))
830,831: }   (None)
831,840: FstringMiddle   (Str(" from tse"))
840,841: FStringEnd   (Str("\""))
841,842: )   (None)
842,843: NewLine   (None)
855,861: Return   (None)
862,863: [   (None)
863,871: Identifier   (Str("date_obj"))
871,872: ,   (None)
873,875: Identifier   (Str("pd"))
875,876: .   (None)
876,890: Identifier   (Str("json_normalize"))
890,891: (   (None)
891,895: Identifier   (Str("data"))
895,896: [   (None)
896,910: StringLiteral   (Str("\"tradeHistory\""))
910,911: ]   (None)
911,912: )   (None)
912,913: ]   (None)
913,914: NewLine   (None)
914,914: Dedent   (Indent(3))
914,914: Dedent   (None)
914,914: Dedent   (None)
914,920: Except   (None)
921,922: (   (None)
922,929: Identifier   (Str("aiohttp"))
929,930: .   (None)
930,941: Identifier   (Str("ClientError"))
941,942: ,   (None)
943,950: Identifier   (Str("asyncio"))
950,951: .   (None)
951,963: Identifier   (Str("TimeoutError"))
963,964: )   (None)
964,965: :   (None)
965,966: NewLine   (None)
966,970: Indent   (Indent(1))
970,976: Identifier   (Str("logger"))
976,977: .   (None)
977,982: Identifier   (Str("error"))
982,983: (   (None)
983,985: FStringStart   (Str("f\""))
985,1004: FstringMiddle   (Str("Request failed for "))
1004,1005: {   (None)
1005,1013: Identifier   (Str("date_obj"))
1013,1014: }   (None)
1014,1027: FstringMiddle   (Str(". Retrying..."))
1027,1028: FStringEnd   (Str("\""))
1028,1029: )   (None)
1029,1030: NewLine   (None)
1034,1045: Identifier   (Str("retry_count"))
1046,1048: +=   (None)
1049,1050: Integer   (Number("1"))
1050,1051: NewLine   (None)
1055,1060: Await   (None)
1061,1068: Identifier   (Str("asyncio"))
1068,1069: .   (None)
1069,1074: Identifier   (Str("sleep"))
1074,1075: (   (None)
1075,1076: Integer   (Number("1"))
1076,1077: )   (None)
1077,1078: NewLine   (None)
1078,1078: Dedent   (Indent(1))
